<div class="inbox-container">
  <div class="navbar-top-container">
    <%= render "shared/navbar_top" %>
  </div>
  <div class="inbox-body">
    <h1 class="inbox-header">Inbox</h1>
    <%# INBOX NAVIGATION TABS %>
    <div class="tab">
      <%= link_to "MAP", map_path, class: "btn btn-primary" %>
      <button class="tablinks active" onclick="openTag(event, 'All')">All</button>
      <button class="tablinks" onclick="openTag(event, 'Casting')">Castings</button>
      <button class="tablinks" onclick="openTag(event, 'Option')">Options</button>
      <button class="tablinks" onclick="openTag(event, 'Job')">Jobs</button>
    </div>

    <div id="All" class="tabcontent connections-inbox active">

      <% @connections.each do |connection| %>
        <%# IF CASTING %>
        <% if connection.listing.listing_type == 'casting' %>
          <div>
            <%= link_to connection_path(connection), class: "connection-container" do %>
              <%= render 'shared/avatar_inbox' %>
              <div class="connection-info">
                <% if connection.opened == true %>
                  <span class="p-light"><%= connection.listing.client.name %></span>
                  <span class="p-light"><%= connection.listing.start_date.strftime('%-d %B') %></span>
                  <span class="p-light"><%= connection.listing.start_time.strftime('%H:%M') %> - <%= connection.listing.end_time.strftime('%H:%M') %></span>
                <% else %>
                  <span class="p-xbold"><%= connection.listing.client.name %></span>
                  <span class="p-xbold"><%= connection.listing.start_date.strftime('%-d %B') %></span>
                  <span class="p-xbold"><%= connection.listing.start_time.strftime('%H:%M') %> - <%= connection.listing.end_time.strftime('%H:%M') %></span>
                <% end %>
              </div>
              <div class="connection-listing-type">
                <span class="p-light"><%= connection.listing.listing_type.upcase %></span>
              </div>
            <% end %>
          </div>
        <%# IF OPTION %>
        <% elsif connection.listing.listing_type == 'option' %>
          <div>
            <%= link_to connection_path(connection), class: "connection-container" do %>
              <%= render 'shared/avatar_inbox' %>
              <div class="connection-info">
                <% if connection.opened == true %>
                  <span class="p-light"><%= connection.listing.client.name %></span>
                  <span class="p-light"><%= connection.listing.start_date.strftime('%-d %B') %> - <%= connection.listing.end_date.presence&.strftime('%-d %B') %></span>
                  <span class="p-light"><%= connection.listing.extra_info.presence&.truncate(40) %></span>
                <% else %>
                  <span class="p-xbold"><%= connection.listing.client.name %></span>
                  <span class="p-xbold"><%= connection.listing.start_date.strftime('%-d %B') %> - <%= connection.listing.end_date.presence&.strftime('%-d %B') %></span>
                  <span class="p-standard"><%= connection.listing.extra_info.presence&.truncate(40) %></span>
                <% end %>
              </div>
              <div class="connection-listing-type">
                <span class="p-light"><%= connection.listing.listing_type.upcase %></span>
              </div>
            <% end %>
          </div>

        <%# IF  JOB %>
        <% elsif connection.listing.listing_type == 'job' %>
          <div>
            <%= link_to connection_path(connection), class: "connection-container" do %>
              <%= render 'shared/avatar_inbox' %>
              <div class="connection-info">
                <% if connection.opened == true %>
                  <span class="p-light"><%= connection.listing.client.name %></span>
                  <span class="p-light"><%= connection.listing.start_date.presence&.strftime('%-d %B') %></span>
                  <span class="p-light"><%= connection.listing.start_time.presence&.strftime('%H:%M') %></span>
                <% else %>
                  <span class="p-xbold"><%= connection.listing.client.name %></span>
                  <span class="p-xbold"><%= connection.listing.start_date.presence&.strftime('%-d %B') %></span>
                  <span class="p-xbold"><%= connection.listing.start_time.presence&.strftime('%H:%M') %></span>
                <% end %>
              </div>
              <div class="connection-listing-type">
                <span class="p-light"><%= connection.listing.listing_type.upcase %></span>
              </div>
            <% end %>
          </div>
        <% end %>

      <% end %>
    </div>
  </div>

    <%# CASTINGS %>
    <div id="Casting" class="tabcontent connections-inbox">
      <% @castings.each do |casting| %>
        <div>
          <%= link_to connection_path(casting), class: "connection-container" do %>
            <%= render 'shared/avatar_inbox' %>
            <div class="connection-info">
              <% if casting.opened == true %>
                <span class="p-light"><%= casting.listing.client.name %></span>
                <span class="p-light"><%= casting.listing.start_date.strftime('%-d %B') %></span>
                <span class="p-light"><%= casting.listing.start_time.strftime('%H:%M') %> - <%= casting.listing.end_time.strftime('%H:%M') %></span>
              <% else %>
                <span class="p-xbold"><%= casting.listing.client.name %></span>
                <span class="p-xbold"><%= casting.listing.start_date.strftime('%-d %B') %></span>
                <span class="p-xbold"><%= casting.listing.start_time.strftime('%H:%M') %> - <%= casting.listing.end_time.strftime('%H:%M') %></span>
              <% end %>
            </div>
            <div class="connection-listing-type">
              <span class="p-light"><%= casting.listing.listing_type.upcase %></span>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>

    <%# OPTIONS %>
    <div id="Option" class="tabcontent connections-inbox">
      <% @options.each do |option| %>
        <div>
          <%= link_to connection_path(option), class: "connection-container" do %>
            <%= render 'shared/avatar_inbox' %>
            <div class="connection-info">
              <% if option.opened == true %>
                <span class="p-light"><%= option.listing.client.name %></span>
                <span class="p-light"><%= option.listing.start_date.strftime('%-d %B') %> - <%= option.listing.end_date.presence&.strftime('%-d %B') %></span>
                <span class="p-light"><%= option.listing.extra_info.presence&.truncate(40) %></span>
              <% else %>
                <span class="p-xbold"><%= option.listing.client.name %></span>
                <span class="p-xbold"><%= option.listing.start_date.strftime('%-d %B') %> - <%= option.listing.end_date.presence&.strftime('%-d %B') %></span>
                <span class="p-standard"><%= option.listing.extra_info.presence&.truncate(40) %></span>
              <% end %>
            </div>
            <div class="connection-listing-type">
              <span class="p-light"><%= option.listing.listing_type.upcase %></span>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>

    <%# JOBS %>
    <div id="Job" class="tabcontent connections-inbox">
      <% @jobs.each do |job| %>
        <div>
          <%= link_to connection_path(job), class: "connection-container" do %>
            <%= render 'shared/avatar_inbox' %>
            <div class="connection-info">
              <% if job.opened == true %>
                <span class="p-light"><%= job.listing.client.name %></span>
                <span class="p-light"><%= job.listing.start_date.presence&.strftime('%-d %B') %></span>
                <span class="p-light"><%= job.listing.start_time.presence&.strftime('%H:%M') %></span>
              <% else %>
                <span class="p-xbold"><%= job.listing.client.name %></span>
                <span class="p-xbold"><%= job.listing.start_date.presence&.strftime('%-d %B') %></span>
                <span class="p-xbold"><%= job.listing.start_time.presence&.strftime('%H:%M') %></span>
              <% end %>
            </div>
            <div class="connection-listing-type">
              <span class="p-light"><%= job.listing.listing_type.upcase %></span>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>

    <script>
      function openTag(evt, tagName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
          tabcontent[i].classList.remove("active"); // Remove active class from content divs
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(tagName).style.display = "block";
        document.getElementById(tagName).classList.add("active"); // Add active class to content div
        if (evt && evt.currentTarget) {
          evt.currentTarget.className += " active";
        } else {
          const defaultButton = document.querySelector(`.tablinks[onclick*="'${tagName}'"]`);
          if (defaultButton) {
            defaultButton.className += " active";
          }
        }
      }
      document.addEventListener("DOMContentLoaded", function() {
        openTag(null, 'All');
      });
    </script>
  </div>

  <div class="navbar-bottom-container">
    <div class="navbar-bottom">
      <%= render 'shared/mobile-app-navbar' %>
    </div>
  </div>

</div>
